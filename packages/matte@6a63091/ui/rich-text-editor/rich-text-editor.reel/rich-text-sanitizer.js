var Montage=require("montage").Montage;exports.Sanitizer=Montage.specialize({willSetValue:{value:function(e,t){return this._scopeCSS(e,t)}},didGetValue:{value:function(e,t){return this._unscopeCSS(e,t)}},willInsertHtmlData:{value:function(e,t){return this._scopeCSS(this._removeScript(e),t)}},_scopeCSS:{enumerable:!0,value:function(e,t){var n=".editor-"+t+" ";return"string"==typeof e&&(e=e.replace(/(<style ?[^>]*>)([^<]*)(<\/style>)/gi,function(e,t,r,i){return r=r.replace(/\t|\n|\r/g,function(e){return"	"==e?" ":""}),r=r.replace(/\*\.editor-[^ ] +/g,"body"),r=r.replace(/\.editor-[^ ]+ /g,""),r=r.replace(/([^{]+)({[^}]*})/gi,function(e,t,r){return t=t.replace(/ *([^,]+)/g,function(e,t){return"body"==t.toLowerCase()?"*"+n:n+t}),t+r}),t+r+i})),e}},_unscopeCSS:{enumerable:!0,value:function(e){return"string"==typeof e&&(e=e.replace(/(<style ?[^>]*>)([^<]*)(<\/style>)/gi,function(e,t,n,r){return n=n.replace(/\*\.editor-[^ ] +/g,"body"),n=n.replace(/\.editor-[^ ]+ /g,""),t+n+r})),e}},_removeScript:{enumerable:!0,value:function(e){var t=document.createElement("div"),n=function(e){var t,r,i,a=e.children,s=a.length,o=e.attributes,l=o.length;for(i=0;l>i;i++)r=o[i],(r.name.match(/^on[a-z]+/i)||r.value.match(/^javascript:/))&&(e.removeAttribute(r.name),i--,l--);for(i=0;s>i;i++)t=a[i],"SCRIPT"==t.tagName?(t.parentNode.removeChild(t),i--,s--):n(t)};return t.innerHTML=e,n(t),t.innerHTML}}});