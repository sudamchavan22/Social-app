var Q=require("q"),StatusApps=require("./status");exports.Cap=function(e,t){return t=t||StatusApps.notFound,function(n,r){return""===n.pathInfo||"/"===n.pathInfo?e(n,r):t(n,r)}},exports.Tap=function(e,t){return function(){var n=this,r=arguments;return Q.when(t.apply(this,arguments),function(t){return t?t:e.apply(n,r)})}},exports.Trap=function(e,t){return function(n){return Q.when(e.apply(this,arguments),function(e){return e?(e.headers=e.headers||{},t(e,n)||e):void 0})}},exports.Branch=function(e,t){return e||(e={}),t||(t=StatusApps.notFound),function(n,r){if(!/^\//.test(n.pathInfo))return t(n,r);var i=n.pathInfo.slice(1),a=i.split("/"),s=decodeURIComponent(a.shift());return Object.has(e,s)?(n.scriptName=n.scriptName+s+"/",n.pathInfo=i.slice(s.length),Object.get(e,s)(n,r)):t(n,r)}},exports.FirstFound=function(e){return function(t){function n(){var a=e[r++](t,a);return i>r?Q.when(a,function(e){return 404===e.status?n():e}):a}var r=0,i=e.length;return n()}};