var Q=require("q"),Content=require("./content"),Status=require("./status");exports.HandleJsonResponses=function(e,t,n){return function(r){return r.handleJsonResponse=exports.handleJsonResponse,Q.fcall(e,r).then(function(e){return void 0!==e.data?Q.fcall(exports.handleJsonResponse,e,t,n):e})}},exports.handleJsonResponse=function(e,t,n){return e.headers["content-type"]="application/json",e.body={forEach:function(r){r(JSON.stringify(e.data,t,n))}},e},exports.Json=function(e,t,n){return function(r,i){return Q.when(e(r,i),function(e){return exports.json(e,t,n)})}},exports.json=function(e,t,n){try{var r=JSON.stringify(e,t,n)}catch(i){return Q.reject(i)}return Content.ok([r])},exports.JsonRequest=function(e,t){return t||(t=Status.badRequest),Content.ContentRequest(function(n,r,i){try{var a=JSON.parse(n)}catch(s){return t(r,s)}return e(a,r,i)})};