function RootFs(e,t){function n(n){var r;return r=e.isAbsolute(n)?e.relativeFromDirectory(e.ROOT,n):n,r=e.join(e.ROOT,r),r=e.relativeFromDirectory(e.ROOT,r),r=e.join(t,r),e.canonical(r).then(function(e){return e},function(){return r}).then(function(r){return e.contains(t,r)?{inner:e.join(e.ROOT,e.relativeFromDirectory(t,r)),outer:r}:Q.reject("Can't find: "+JSON.stringify(n))})}function r(){return e.ROOT}var i=Object.create(BOOT);return COMMON.update(i,r),i.list=function(t){return n(t).then(function(t){return e.list(t.outer)}).then(null,function(){return Q.reject("Can't list "+JSON.stringify(t))})},i.open=function(t,r,i){return n(t).then(function(t){return e.open(t.outer,r,i)}).then(null,function(){return Q.reject("Can't open "+JSON.stringify(t))})},i.stat=function(t){return n(t).then(function(t){return e.stat(t.outer)}).then(null,function(){return Q.reject("Can't stat "+JSON.stringify(t))})},i.statLink=function(t){return n(t).then(function(t){return e.statLink(t.outer)}).then(null,function(){return Q.reject("Can't statLink "+JSON.stringify(t))})},i.canonical=function(e){return n(e).then(function(e){return e.inner}).then(null,function(){return Q.reject("Can't find canonical of "+JSON.stringify(e))})},i.makeDirectory=function(t){return n(t).then(function(t){return e.makeDirectory(t.outer)}).catch(function(){throw Error("Can't make directory "+JSON.stringify(t))})},i.removeDirectory=function(t){return n(t).then(function(t){return e.removeDirectory(t.outer)}).catch(function(){throw Error("Can't remove directory "+JSON.stringify(t))})},i.remove=function(t){return n(t).then(function(t){return e.remove(t.outer)}).catch(function(){throw Error("Can't remove "+JSON.stringify(t))})},i.makeTree=function(t){return n(t).then(function(t){return e.makeTree(t.outer)}).catch(function(){throw Error("Can't make tree "+JSON.stringify(t))})},i.removeTree=function(t){return n(t).then(function(t){return e.removeTree(t.outer)}).catch(function(){throw Error("Can't remove tree "+JSON.stringify(t))})},Q.when(e.canonical(t),function(e){return t=e,i})}var Q=require("q"),BOOT=require("./fs-boot"),COMMON=require("./fs-common");module.exports=RootFs;