function Writer(e,t){var n=Object.create(Writer.prototype);t&&e.setEncoding&&e.setEncoding(t);var r=Q.defer();return e.on("error",function(e){r.reject(e),r=Q.defer()}),e.on("drain",function(){r.resolve(),r=Q.defer()}),n.write=function(t){return e.writeable||e.writable?("string"!=typeof t&&(t=new Buffer(t)),e.write(t)?Q.resolve():r.promise):Q.reject(Error("Can't write to non-writable (possibly closed) stream"))},n.flush=function(){return r.promise},n.close=function(){var t;return supportsFinish&&(t=Q.defer(),e.on("finish",function(){t.resolve()}),e.on("error",function(e){t.reject(e)})),e.end(),r.resolve(),t?t.promise:Q()},n.destroy=function(){return e.destroy(),r.resolve(),Q.resolve()},n.node=e,Q(n)}var Q=require("q");module.exports=Writer;var version=process.versions.node.split("."),supportsFinish=version[0]>=0&&version[1]>=10;