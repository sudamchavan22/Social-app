montageDefine("07f2c2d","buffer-stream",{dependencies:["q","./reader"],factory:function(e,t,n){function r(e,t){return this instanceof r?(e?Array.isArray(e)||(e=[e]):e=[],this._charset=t,this._chunks=e,this._close=i.defer(),this.closed=this._close.promise,void 0):new r(e,t)}var i=e("q"),a=e("./reader");n.exports=r,r.prototype.forEach=function(e,t){var n=this,r=n._chunks;return i.fcall(function(){r.splice(0,r.length).forEach(e,t)})},r.prototype.read=function(){var e;return e=a.join(this._chunks),this._charset&&(e=e.toString(this._charset)),i.resolve(e)},r.prototype.write=function(e){if(this._charset)e=new Buffer(e+"",this._charset);else if(!(e instanceof Buffer))throw Error("Can't write strings to buffer stream without a charset: "+e);return this._chunks.push(e),i.resolve()},r.prototype.close=function(){return this._close.resolve(),i.resolve()},r.prototype.destroy=function(){return this._close.resolve(),i.resolve()}}});